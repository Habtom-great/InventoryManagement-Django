{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %} Sales List {% endblock title %}

{% block content %}

<div class="row" style="color:#575757;font-weight:bold;font-size:2rem;">
    <div class="col-md-8">Sales List</div>
    <div class="col-md-4 text-end">
        <a class="btn btn-success" href="{% url 'transactions:new-sale' %}">
            New Outgoing Stock
        </a>
    </div>
</div>

<br>

{% if bills %}
<table class="table table-bordered table-hover">
    <thead class="thead-dark align-middle">
        <tr>
            <th>Bill No.</th>
            <th>Customer</th>
            <th>Stocks Sold</th>
            <th>Qty</th>
            <th>Total (Birr)</th>
            <th>Date</th>
            <th width="25%">Actions</th>
        </tr>
    </thead>

    <tbody>
    {% for sale in bills %}
        <tr>
            <td>{{ sale.billno }}</td>
            <td>
                {{ sale.name }}<br>
                <small class="text-muted">Ph: {{ sale.phone }}</small>
            </td>

            <td>
                {% for item in sale.get_items_list %}
                    {{ item.stock.name }}<br>
                {% endfor %}
            </td>

            <td>
                {% for item in sale.get_items_list %}
                    {{ item.quantity }}<br>
                {% endfor %}
            </td>

            <td>Birr {{ sale.get_total_price|floatformat:2 }}</td>
            <td>{{ sale.time|date:"Y-m-d" }}</td>

            <td>
                <!-- Main actions -->
                <a href="{% url 'transactions:sale-bill' sale.billno %}"
                   class="btn btn-secondary btn-sm mb-1">
                    View
                </a>

                <a href="{% url 'transactions:edit-sale' sale.pk %}"
                   class="btn btn-warning btn-sm mb-1">
                    Edit
                </a>

                <a href="{% url 'transactions:delete-sale' sale.pk %}"
                   class="btn btn-danger btn-sm mb-1"
                   onclick="return confirm('Are you sure you want to delete this sale?');">
                    Delete
                </a>

                <br>

                <!-- Export -->
                <a href="{% url 'transactions:export-sale-excel' sale.billno %}"
                   class="btn btn-success btn-sm">
                    Excel
                </a>

                <a href="{% url 'transactions:export-sale-pdf' sale.billno %}"
                   class="btn btn-primary btn-sm">
                    PDF
                </a>

                <a href="{% url 'transactions:export-sale-word' sale.billno %}"
                   class="btn btn-info btn-sm">
                    Word
                </a>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Pagination -->
{% if is_paginated %}
<div class="mt-3">
    {% if page_obj.has_previous %}
        <a class="btn btn-outline-info" href="?page=1">First</a>
        <a class="btn btn-outline-info" href="?page={{ page_obj.previous_page_number }}">Previous</a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
            <a class="btn btn-info" href="?page={{ num }}">{{ num }}</a>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a class="btn btn-outline-info" href="?page={{ num }}">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a class="btn btn-outline-info" href="?page={{ page_obj.next_page_number }}">Next</a>
        <a class="btn btn-outline-info" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="text-center mt-5" style="font-size:1.5rem;color:#575757;">
    The records are empty. Please try adding some.
</div>
{% endif %}

{% endblock content %}
